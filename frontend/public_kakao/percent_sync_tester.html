<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ì¤‘ì¹˜ ë™ê¸°í™” í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .header p {
            color: #666;
            font-size: 16px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            background: #f8fafc;
        }
        
        .test-section h3 {
            color: #334155;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .weight-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .weight-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .weight-item label {
            font-weight: 500;
            color: #475569;
            font-size: 14px;
        }
        
        .weight-input {
            padding: 8px 12px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        .weight-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .total-display {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
        }
        
        .total-display.valid {
            background: #dcfce7;
            border-color: #10b981;
            color: #065f46;
        }
        
        .total-display.invalid {
            background: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .status-display {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .instructions {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .instructions h3 {
            margin-bottom: 10px;
        }
        
        .instructions ol {
            margin-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 5px;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .loading {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ ê°€ì¤‘ì¹˜ ë™ê¸°í™” í…ŒìŠ¤íŠ¸ ë„êµ¬</h1>
            <p>percent.js ì‹œìŠ¤í…œì˜ ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™”ë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤</p>
        </div>
        
        <div class="instructions">
            <h3>ğŸ“‹ í…ŒìŠ¤íŠ¸ ë°©ë²•</h3>
            <ol>
                <li>ì•„ë˜ ê°€ì¤‘ì¹˜ ê°’ë“¤ì„ ì¡°ì •í•˜ì—¬ <strong>ì´í•© 100%</strong>ë¥¼ ë§Œë“œì„¸ìš”</li>
                <li><strong>"ê°€ì¤‘ì¹˜ ì ìš© ë° ë™ê¸°í™”"</strong> ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</li>
                <li>ë‹¤ë¥¸ íƒ­ë“¤(mainpage.html, rank_member.html, rank_party.html)ì„ ì—´ì–´ì„œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”</li>
                <li>ìƒíƒœ ë¡œê·¸ì—ì„œ ë™ê¸°í™” ê³¼ì •ì„ ëª¨ë‹ˆí„°ë§í•˜ì„¸ìš”</li>
            </ol>
        </div>
        
        <div class="test-section">
            <h3>âš–ï¸ ê°€ì¤‘ì¹˜ ì„¤ì •</h3>
            <div class="weight-grid">
                <div class="weight-item">
                    <label>ê°„ì‚¬</label>
                    <input type="number" class="weight-input" data-weight="ê°„ì‚¬" value="3" min="0" max="100">
                </div>
                <div class="weight-item">
                    <label>ë¬´íš¨í‘œ ë° ê¸°ê¶Œ</label>
                    <input type="number" class="weight-input" data-weight="ë¬´íš¨í‘œ ë° ê¸°ê¶Œ" value="2" min="0" max="100">
                </div>
                <div class="weight-item">
                    <label>ë³¸íšŒì˜ ê°€ê²°</label>
                    <input type="number" class="weight-input" data-weight="ë³¸íšŒì˜ ê°€ê²°" value="40" min="0" max="100">
                </div>
                <div class="weight-item">
                    <label>ìœ„ì›ì¥</label>
                    <input type="number" class="weight-input" data-weight="ìœ„ì›ì¥" value="5" min="0" max="100">
                </div>
                <div class="weight-item">
                    <label>ì²­ì› ì†Œê°œ</label>
                    <input type="number" class="weight-input" data-weight="ì²­ì› ì†Œê°œ" value="8" min="0" max="100">
                </div>
                <div class="weight-item">
                    <label>ì²­ì› ê²°ê³¼</label>
                    <input type="number" class="weight-input" data-weight="ì²­ì› ê²°ê³¼" value="23" min="0" max="100">
                </div>
                <div class="weight-item">
                    <label>ì¶œì„</label>
                    <input type="number" class="weight-input" data-weight="ì¶œì„" value="8" min="0" max="100">
                </div>
                <div class="weight-item">
                    <label>íˆ¬í‘œ ê²°ê³¼ ì¼ì¹˜</label>
                    <input type="number" class="weight-input" data-weight="íˆ¬í‘œ ê²°ê³¼ ì¼ì¹˜" value="7" min="0" max="100">
                </div>
                <div class="weight-item">
                    <label>íˆ¬í‘œ ê²°ê³¼ ë¶ˆì¼ì¹˜</label>
                    <input type="number" class="weight-input" data-weight="íˆ¬í‘œ ê²°ê³¼ ë¶ˆì¼ì¹˜" value="4" min="0" max="100">
                </div>
            </div>
            
            <div class="total-display" id="totalDisplay">
                ì´í•©: <span id="totalValue">100</span>% 
                <span id="totalStatus">âœ… 100% ë‹¬ì„±!</span>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸš€ ë™ê¸°í™” í…ŒìŠ¤íŠ¸</h3>
            <button class="btn btn-success" onclick="applyWeightsAndSync()">
                ğŸ¯ ê°€ì¤‘ì¹˜ ì ìš© ë° ë™ê¸°í™”
            </button>
            <button class="btn btn-primary" onclick="checkConnectionStatus()">
                ğŸ” ì—°ê²° ìƒíƒœ í™•ì¸
            </button>
            <button class="btn btn-warning" onclick="testBroadcast()">
                ğŸ“¡ ë¸Œë¡œë“œìºìŠ¤íŠ¸ í…ŒìŠ¤íŠ¸
            </button>
            <button class="btn btn-danger" onclick="resetToOriginal()">
                ğŸ”„ ì›ë³¸ ë°ì´í„°ë¡œ ë¦¬ì…‹
            </button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“Š ìƒíƒœ ëª¨ë‹ˆí„°ë§</h3>
            <div class="status-display" id="statusLog">
                ğŸ“± ë™ê¸°í™” í…ŒìŠ¤íŠ¸ ë„êµ¬ ì¤€ë¹„ ì™„ë£Œ
                
                ğŸ”— ë‹¤ìŒ í˜ì´ì§€ë“¤ì´ ì—´ë ¤ìˆì–´ì•¼ í•©ë‹ˆë‹¤:
                - mainpage.html (ë©”ì¸ í˜ì´ì§€)
                - rank_member.html (ì˜ì› ë­í‚¹)
                - rank_party.html (ì •ë‹¹ ë­í‚¹)
                - percent.html (ê°€ì¤‘ì¹˜ ì„¤ì •)
                
                ğŸ’¡ íŒ: ê° í˜ì´ì§€ë¥¼ ìƒˆ íƒ­ìœ¼ë¡œ ì—´ì–´ë‘ê³  í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”!
            </div>
        </div>
    </div>

    <script>
        // ê°€ì¤‘ì¹˜ ê³„ì‚° ë° UI ì—…ë°ì´íŠ¸
        function updateTotal() {
            const inputs = document.querySelectorAll('.weight-input');
            let total = 0;
            
            inputs.forEach(input => {
                total += parseFloat(input.value) || 0;
            });
            
            const totalValue = document.getElementById('totalValue');
            const totalStatus = document.getElementById('totalStatus');
            const totalDisplay = document.getElementById('totalDisplay');
            
            totalValue.textContent = total.toFixed(1);
            
            if (Math.abs(total - 100) < 0.1) {
                totalDisplay.className = 'total-display valid';
                totalStatus.textContent = 'âœ… 100% ë‹¬ì„±!';
            } else {
                totalDisplay.className = 'total-display invalid';
                totalStatus.textContent = `âš ï¸ ${total > 100 ? 'ì´ˆê³¼' : 'ë¶€ì¡±'} (${(100 - total).toFixed(1)}% ${total > 100 ? 'ê°ì†Œ' : 'ì¶”ê°€'} í•„ìš”)`;
            }
        }
        
        // ê°€ì¤‘ì¹˜ ì…ë ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.querySelectorAll('.weight-input').forEach(input => {
            input.addEventListener('input', updateTotal);
        });
        
        // ë¡œê·¸ ì¶”ê°€ í•¨ìˆ˜
        function addLog(message, type = 'info') {
            const statusLog = document.getElementById('statusLog');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'ğŸ“¡';
            
            statusLog.textContent += `\n[${timestamp}] ${icon} ${message}`;
            statusLog.scrollTop = statusLog.scrollHeight;
        }
        
        // ê°€ì¤‘ì¹˜ ì ìš© ë° ë™ê¸°í™”
        async function applyWeightsAndSync() {
            const inputs = document.querySelectorAll('.weight-input');
            let total = 0;
            const weights = {};
            
            inputs.forEach(input => {
                const value = parseFloat(input.value) || 0;
                weights[input.dataset.weight] = value;
                total += value;
            });
            
            if (Math.abs(total - 100) > 0.1) {
                addLog(`ê°€ì¤‘ì¹˜ ì´í•©ì´ 100%ê°€ ì•„ë‹™ë‹ˆë‹¤ (í˜„ì¬: ${total.toFixed(1)}%)`, 'error');
                return;
            }
            
            addLog('ê°€ì¤‘ì¹˜ ì ìš© ë° ë™ê¸°í™” ì‹œì‘...', 'info');
            
            try {
                // í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
                const testData = {
                    type: 'calculated_data_distribution',
                    source: 'sync_tester',
                    timestamp: new Date().toISOString(),
                    appliedWeights: weights,
                    
                    // ëª¨ì˜ ì •ë‹¹ ë°ì´í„°
                    partyData: {
                        total: 8,
                        top3: [
                            { rank: 1, name: 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹', score: 87.5, original_score: 78.1, score_changed: true, weight_applied: true },
                            { rank: 2, name: 'ì§„ë³´ë‹¹', score: 85.2, original_score: 75.8, score_changed: true, weight_applied: true },
                            { rank: 3, name: 'ì¡°êµ­í˜ì‹ ë‹¹', score: 82.9, original_score: 72.3, score_changed: true, weight_applied: true }
                        ],
                        full_list: [
                            { rank: 1, name: 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹', calculated_score: 87.5, original_score: 78.1, score_changed: true, weight_applied: true },
                            { rank: 2, name: 'ì§„ë³´ë‹¹', calculated_score: 85.2, original_score: 75.8, score_changed: true, weight_applied: true },
                            { rank: 3, name: 'ì¡°êµ­í˜ì‹ ë‹¹', calculated_score: 82.9, original_score: 72.3, score_changed: true, weight_applied: true },
                            { rank: 4, name: 'êµ­ë¯¼ì˜í˜', calculated_score: 79.8, original_score: 69.5, score_changed: true, weight_applied: true },
                            { rank: 5, name: 'ê°œí˜ì‹ ë‹¹', calculated_score: 76.4, original_score: 67.2, score_changed: true, weight_applied: true },
                            { rank: 6, name: 'ê¸°ë³¸ì†Œë“ë‹¹', calculated_score: 73.1, original_score: 65.8, score_changed: true, weight_applied: true },
                            { rank: 7, name: 'ì‚¬íšŒë¯¼ì£¼ë‹¹', calculated_score: 70.5, original_score: 63.4, score_changed: true, weight_applied: true },
                            { rank: 8, name: 'ë¬´ì†Œì†', calculated_score: 68.2, original_score: 61.1, score_changed: true, weight_applied: true }
                        ]
                    },
                    
                    // ëª¨ì˜ ì˜ì› ë°ì´í„°  
                    memberData: {
                        total: 300,
                        top3: [
                            { rank: 1, name: 'ì–´ê¸°êµ¬', party: 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹', score: 94.2, original_score: 88.5, score_changed: true, weight_applied: true },
                            { rank: 2, name: 'ì´ê±´íƒœ', party: 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹', score: 91.8, original_score: 85.3, score_changed: true, weight_applied: true },
                            { rank: 3, name: 'ë°•ì„±ì¤€', party: 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹', score: 89.5, original_score: 82.7, score_changed: true, weight_applied: true }
                        ],
                        full_list: generateMockMemberData()
                    },
                    
                    // ë©”íƒ€ë°ì´í„°
                    calculationInfo: {
                        member_count: 300,
                        party_count: 8,
                        calculation_method: 'test_weighted',
                        api_sources: ['test_api']
                    }
                };
                
                // localStorageì— ì €ì¥
                localStorage.setItem('calculated_data_distribution', JSON.stringify(testData));
                addLog(`localStorageì— ê³„ì‚° ë°ì´í„° ì €ì¥ ì™„ë£Œ`, 'success');
                
                // BroadcastChannelë¡œ ì „ì†¡
                if (typeof BroadcastChannel !== 'undefined') {
                    const channel = new BroadcastChannel('client_weight_updates_v4');
                    channel.postMessage(testData);
                    channel.close();
                    addLog('BroadcastChannelë¡œ ë°ì´í„° ì „ì†¡ ì™„ë£Œ', 'success');
                } else {
                    addLog('BroadcastChannel ë¯¸ì§€ì›', 'warning');
                }
                
                // ì •ë¦¬
                setTimeout(() => {
                    localStorage.removeItem('calculated_data_distribution');
                    addLog('localStorage ì •ë¦¬ ì™„ë£Œ', 'info');
                }, 1000);
                
                addLog(`âœ¨ ë™ê¸°í™” ì™„ë£Œ! ê°€ì¤‘ì¹˜ ${Object.keys(weights).length}ê°œ ì ìš©`, 'success');
                addLog('ğŸ¯ ë‹¤ë¥¸ íƒ­ë“¤ì„ í™•ì¸í•´ë³´ì„¸ìš”!', 'success');
                
            } catch (error) {
                addLog(`ë™ê¸°í™” ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // ì‹¤ì œ ì˜ì› ì´ë¦„ì„ ì‚¬ìš©í•œ ëª¨ì˜ ë°ì´í„° ìƒì„±
        function generateMockMemberData() {
            const realMembers = [
                { name: 'ì–´ê¸°êµ¬', party: 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹' },
                { name: 'ì´ê±´íƒœ', party: 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹' },
                { name: 'ë°•ì„±ì¤€', party: 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹' },
                { name: 'ê°•ë³‘ì›', party: 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹' },
                { name: 'ê¹€ìŠ¹ì›', party: 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹' },
                { name: 'ë‚˜ê²½ì›', party: 'êµ­ë¯¼ì˜í˜' },
                { name: 'ì •ì ì‹', party: 'êµ­ë¯¼ì˜í˜' },
                { name: 'í™ì¤€í‘œ', party: 'êµ­ë¯¼ì˜í˜' },
                { name: 'ê¹€ê¸°í˜„', party: 'êµ­ë¯¼ì˜í˜' },
                { name: 'ê¶Œì˜ì„¸', party: 'êµ­ë¯¼ì˜í˜' },
                { name: 'ì¡°êµ­', party: 'ì¡°êµ­í˜ì‹ ë‹¹' },
                { name: 'ê¹€ì¢…ë¯¼', party: 'ì¡°êµ­í˜ì‹ ë‹¹' },
                { name: 'ì²œí•˜ëŒ', party: 'ê°œí˜ì‹ ë‹¹' },
                { name: 'í—ˆì€ì•„', party: 'ê°œí˜ì‹ ë‹¹' },
                { name: 'ê°•ì€ë¯¸', party: 'ì§„ë³´ë‹¹' },
                { name: 'ìœ¤ì¢…ì˜¤', party: 'ì§„ë³´ë‹¹' },
                { name: 'ìš©í˜œì¸', party: 'ê¸°ë³¸ì†Œë“ë‹¹' },
                { name: 'ì¥ê²½íƒœ', party: 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹' },
                { name: 'ì •ì²­ë˜', party: 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹' },
                { name: 'ë°•ì§€ì›', party: 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹' },
                { name: 'ì´ë‚™ì—°', party: 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹' },
                { name: 'ì†¡ì˜ê¸¸', party: 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹' },
                { name: 'ì£¼í˜¸ì˜', party: 'êµ­ë¯¼ì˜í˜' },
                { name: 'ìœ¤í•œí™', party: 'êµ­ë¯¼ì˜í˜' },
                { name: 'ì •ì§„ì„', party: 'êµ­ë¯¼ì˜í˜' },
                { name: 'ì´ì–¸ì£¼', party: 'ê°œí˜ì‹ ë‹¹' },
                { name: 'ê¹€ì›…', party: 'ê°œí˜ì‹ ë‹¹' },
                { name: 'ë°°í˜„ì§„', party: 'êµ­ë¯¼ì˜í˜' },
                { name: 'ê¹€íƒœë…„', party: 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹' },
                { name: 'ë°•í™ê·¼', party: 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹' }
            ];
            
            const members = [];
            
            for (let i = 0; i < Math.min(30, realMembers.length); i++) {
                const member = realMembers[i];
                members.push({
                    rank: i + 1,
                    name: member.name,
                    party: member.party,
                    calculated_score: Math.round((95 - i * 0.8) * 10) / 10,
                    original_score: Math.round((88 - i * 0.6) * 10) / 10,
                    score_changed: true,
                    weight_applied: true,
                    calculation_timestamp: new Date().toISOString()
                });
            }
            
            return members;
        }
        
        // ì—°ê²° ìƒíƒœ í™•ì¸
        function checkConnectionStatus() {
            addLog('ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...', 'info');
            
            if (typeof BroadcastChannel !== 'undefined') {
                const channel = new BroadcastChannel('client_weight_updates_v4');
                
                const checkMessage = {
                    type: 'connection_check',
                    source: 'sync_tester',
                    timestamp: new Date().toISOString()
                };
                
                let responseCount = 0;
                
                channel.addEventListener('message', function(event) {
                    if (event.data.type === 'connection_response') {
                        responseCount++;
                        addLog(`ì—°ê²°ëœ í˜ì´ì§€ ë°œê²¬: ${event.data.source} (${event.data.data_mode || 'unknown'} ëª¨ë“œ)`, 'success');
                    }
                });
                
                channel.postMessage(checkMessage);
                
                setTimeout(() => {
                    addLog(`ì—°ê²° í™•ì¸ ì™„ë£Œ: ${responseCount}ê°œ í˜ì´ì§€ ì‘ë‹µ`, responseCount > 0 ? 'success' : 'warning');
                    if (responseCount === 0) {
                        addLog('ë‹¤ë¥¸ í˜ì´ì§€ë“¤ì´ ì—´ë ¤ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”', 'warning');
                    }
                    channel.close();
                }, 2000);
                
            } else {
                addLog('BroadcastChannelì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤', 'error');
            }
        }
        
        // ë¸Œë¡œë“œìºìŠ¤íŠ¸ í…ŒìŠ¤íŠ¸
        function testBroadcast() {
            addLog('ë¸Œë¡œë“œìºìŠ¤íŠ¸ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            if (typeof BroadcastChannel !== 'undefined') {
                try {
                    const channel = new BroadcastChannel('client_weight_updates_v4');
                    const testMessage = {
                        type: 'test_broadcast',
                        source: 'sync_tester',
                        timestamp: new Date().toISOString(),
                        message: 'í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ì…ë‹ˆë‹¤!'
                    };
                    
                    channel.postMessage(testMessage);
                    channel.close();
                    
                    addLog('ë¸Œë¡œë“œìºìŠ¤íŠ¸ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡ ì™„ë£Œ', 'success');
                } catch (error) {
                    addLog(`ë¸Œë¡œë“œìºìŠ¤íŠ¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                }
            } else {
                addLog('BroadcastChannelì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'error');
            }
        }
        
        // ì›ë³¸ ë°ì´í„°ë¡œ ë¦¬ì…‹
        function resetToOriginal() {
            addLog('ì›ë³¸ ë°ì´í„°ë¡œ ë¦¬ì…‹ ìš”ì²­...', 'info');
            
            const resetData = {
                type: 'data_reset_to_original',
                source: 'sync_tester',
                timestamp: new Date().toISOString(),
                action: 'reset_to_original'
            };
            
            try {
                // localStorage ì´ë²¤íŠ¸
                localStorage.setItem('calculated_data_distribution', JSON.stringify(resetData));
                
                // BroadcastChannel
                if (typeof BroadcastChannel !== 'undefined') {
                    const channel = new BroadcastChannel('client_weight_updates_v4');
                    channel.postMessage(resetData);
                    channel.close();
                }
                
                setTimeout(() => {
                    localStorage.removeItem('calculated_data_distribution');
                }, 500);
                
                addLog('ì›ë³¸ ë°ì´í„° ë¦¬ì…‹ ìš”ì²­ ì „ì†¡ ì™„ë£Œ', 'success');
                addLog('ğŸ”„ ë‹¤ë¥¸ íƒ­ë“¤ì´ ì›ë³¸ ë°ì´í„°ë¡œ ë³µì›ë©ë‹ˆë‹¤', 'success');
                
            } catch (error) {
                addLog(`ë¦¬ì…‹ ìš”ì²­ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // ì´ˆê¸° ì´í•© ê³„ì‚°
        updateTotal();
        
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ë©”ì‹œì§€
        addLog('ğŸ¯ ê°€ì¤‘ì¹˜ ë™ê¸°í™” í…ŒìŠ¤íŠ¸ ë„êµ¬ ì¤€ë¹„ ì™„ë£Œ!', 'success');
        addLog('ğŸ’¡ ê°€ì¤‘ì¹˜ë¥¼ ì¡°ì •í•˜ê³  "ê°€ì¤‘ì¹˜ ì ìš© ë° ë™ê¸°í™”" ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”', 'info');
    </script>
</body>
</html>